<h1>è¨˜äº‹ä¸€è¦§</h1>
<%= search_form_for @q, url: articles_path, method: :get do |f| %>
  <%= f.label :article_title_or_lead_text, "ã‚¿ã‚¤ãƒˆãƒ«ã¾ãŸã¯ãƒªãƒ¼ãƒ‰æ–‡" %>
  
  <%= select_tag 'search_type', options_for_select([
    ['éƒ¨åˆ†ä¸€è‡´', 'cont'],
    ['å®Œå…¨ä¸€è‡´', 'eq'],
    ['å‰æ–¹ä¸€è‡´', 'start'],
    ['å¾Œæ–¹ä¸€è‡´', 'end']
  ], params[:search_type].presence || 'cont') %>

  <%= f.text_field :article_title_or_lead_text_cont, placeholder: "ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›", value: @search_term %>
  <%= f.submit "æ¤œç´¢" %>
  <%= link_to 'ã‚¯ãƒªã‚¢', articles_path, class: "clear-button" %>
<% end %>

<%# ---------------------------------------------------- %>
<%# ã€AIæ¤œç´¢çµæœã®è¡¨ç¤ºã€‘ %>
<% if @search_term.present? && (@ai_articles.present? || @ai_error.present?) %>
  <div style="border: 1px solid #ccc; padding: 15px; margin-top: 20px; background-color: #f9f9f9;">
    <h2>AIã«ã‚ˆã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¤œç´¢çµæœï¼ˆã€Œ<%= @search_term %>ã€ã«é–¢é€£ï¼‰</h2>
    <div class="ai-summary">
      <%# ğŸš¨ ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º ğŸš¨ %>
      <% if @ai_error.present? %>
        <p style="color: red;"><strong><%= @ai_error %></strong></p>
      <% end %>
      <%# è¨˜äº‹ãƒªã‚¹ãƒˆã®è¡¨ç¤º (ã‚¨ãƒ©ãƒ¼ãŒãªã„ã€ã¾ãŸã¯ã‚¨ãƒ©ãƒ¼ãŒã‚ã£ã¦ã‚‚è¨˜äº‹ãƒªã‚¹ãƒˆãŒç©ºã®é…åˆ—ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹) %>
      <% if @ai_articles.present? %>
        <ul>
          <% @ai_articles.each do |article| %>
            <li>
              <a href="<%= article['url'] %>" target="_blank">
                <b><%= article['title'] %></b>
              </a>
            </li>
          <% end %>
        </ul>
      <% else %>
        <%# ã‚¨ãƒ©ãƒ¼ãŒãªã„ã€ã‹ã¤è¨˜äº‹ãŒå–å¾—ã§ããªã‹ã£ãŸå ´åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ %>
        <% if @ai_error.nil? %>
          <p>é–¢é€£ã™ã‚‹è¨˜äº‹ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
        <% end %>
      <% end %>
    </div>
  </div>
<% end %>
<%# ---------------------------------------------------- %>

<table>
  <thead>
    <tr>
      <th>ã‚¿ã‚¤ãƒˆãƒ«</th>
      <th>è©³ç´°</th>
    </tr>
  </thead>
  <tbody>
    <% @articles.each do |article| %>
      <tr>
        <td><%= article.article_title %></td>
        <td><%= link_to 'è©³ç´°ã‚’è¦‹ã‚‹', article_path(article) %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const searchTypeSelect = document.getElementById('search_type');
    const searchInput = document.querySelector('input[name="q[article_title_or_lead_text_cont]"]');
    
    function updateSearchInputName() {
      const selectedType = searchTypeSelect.value;
      const currentName = searchInput.getAttribute('name');
      const newName = currentName.replace(/_(cont|eq|start|end)/, `_${selectedType}`);
      searchInput.setAttribute('name', newName);
    }

    updateSearchInputName();
    searchTypeSelect.addEventListener('change', updateSearchInputName);
  });
</script>